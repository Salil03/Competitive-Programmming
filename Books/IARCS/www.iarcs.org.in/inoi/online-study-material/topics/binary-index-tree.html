<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title></title>

<meta name="Description" content="">
<meta name="author" content="">
<meta name="keywords" content="">

<meta name="robots" content="all,follow">

<!-- CSS --> 
<link rel="stylesheet" href="styles\default.css" type="text/css" media="screen, projection, tv">
<link rel="stylesheet" href="styles\print.css" type="text/css" media="print">

<!-- Favicon -->
<link rel="shortcut icon" href="img\iarcslogo.png" type="image/x-icon">
</head>

<body id="top">
<div id="wrapper">

	<div class="header">
	<h1><span><a href="http://www.iarcs.org.in/inoi"><span id="color">Indian Computing Olympiad</span></a></span></h1>
	<p id="about">Training Material</p>

	<a href="#skip-menu" class="hidden">Skip menu</a> <!-- Skip menu -->
	<div id="menu-box">
	  <ul id="web">
	    <li><a href="..\contact\index.html">Contact</a></li>
	    <li><a href="..\iindex\index.html">Index</a></li>
	    <li><a href="..\problems\index.html">Problems</a></li>
	    <li><a class="active" id="first" href="index-1.html">Topics</a></li>
	    <li><a href="..\index-1.html">Home</a></li>
	  </ul>
	</div>

	</div> <!-- Header end -->

<hr class="noscreen">

<div id="skip-menu"></div>

<div class="page">
  <div class="col-r">
    <div class="col-r-in">

      <h2><a href="range-queries.html">Range queries</a></h2>

      <h3><span>Binary index tree</span></h3>

      <p>
	Given an array A, we compute a new array BIT that stores sums of some
	segments of A.  Here is an example.
      </p>

<pre>
i   :     1   2   3   4   5   6   7   8
A   :     2   3   1   3   6   2   1   4
          |   |   |   |   |   |   |   |
BIT:      2   |   1   |   6   |   1   |  <-- Store A[i] for odd i
            \ |    \  |     \ |       |
              +     \ |       +
              |       +       |
              5       |       8       |  <--
                \     |        \      |      \  Store segment
                  --- 9 -----   \     |  <-- -  sums as shown,
                             \   \    |       | explained formally
                               ------ +       | below
                                      |      /
                                     22  <--
</pre>

      <p>
	What is stored at in BIT[i]?
      </p>

      <p>
	Write out the positions in binary:
      </p>

<pre>
i   :   0001 0010 0011 0100 0101 0110 0111 1000
A   :     2    3    1    3    6    2    1    4
</pre>

      <p>
	Let k be the number of trailing zeros in binary
	representation of i.  In BIT[i], we store the sum of the
	segment of length 2<sup>k</sup> at position i.
      </p>

      <p>
	Assuming we can do this, how do we use this data to
	compute prefix sums?
      </p>

      <p>
	Suppose we want the prefix sum  A[1] + A[2] + &hellip; + A[i].
      </p>

      <p>
	We know that the sum of some segment to the left of i is
	stored in BIT[i], depending on the binary representation
	of i.
      </p>

      <p>
	We can compute the biggest j &le; i such that j lies
	outside this segment.  Call this value next(i).  We then
	pick up BIT[next(i)] and again compute the biggest k to
	the left of the segment stored in BIT[next(i)] etc
      </p>

      <p>
	How do we compute this value?
      </p>

      <p>
	<table>
	  <tr>
	    <td>
	      Suppose i has k trailing 0's.  It looks like &nbsp;
	    </td>
            <td>
	      <table style="display:inline-table">
		<tr><td><pre>x 1 00000</pre></td></tr>
		<tr><td><pre>    <-k-></pre></td></tr>
	      </table>
	    </td>
	  </tr>
	  <tr>
	    <td>
	      The number we want is i - 2<sup>k</sup>.  But
	      2<sup>k</sup> is
	    </td>
            <td>
	      <table style="display:inline-table">
		<tr><td><pre>  1 00000</pre></td></tr>
		<tr><td><pre>    <-k-></pre></td></tr>
	      </table>
	    </td>
	  </tr>
	  <tr>
	    <td>
	      So, i - 2<sup>k</sup> is just
	    </td>
            <td>
	      <table style="display:inline-table">
		<tr><td><pre>x 0 00000</pre></td></tr>
		<tr><td><pre>    <-k-></pre></td></tr>
	      </table>
	    </td>
	  </tr>
	</table>
      </p>

      <p>
	So, if we start with i, next(i) can be computed by flipping
	the last 1 in the binary represenation of i to a 0.  The
	prefix sum we want is
      </p>

      <p align="center">
	BIT[i] + BIT[next(i)] + BIT[next(next(i))] + &hellip;
      </p>

      <p>
	We stop when we reach a position that is all 0's.
      </p>

      <p>
	Each time we go from BIT[i] to BIT[next[i]], we flip one 1 to
	0.  The binary representation of i has log N bits, so we can
	iterate the next() operation at most log N times.
      </p>

      <p>
	How do we update this data structure when we get an
	instruction of of the form Update(i,a)?
      </p>

      <p>
	We have to update BIT[i] and some BIT[j] for some j &gt; i.
	Which values of j are affected?
      </p>

      <p>
	Clearly, odd values of j are unchanged, since they only refer
	to intervals of length 1.
      </p>

      <p>

                                      
      <p style="display:inline-block">
	Suppose, again that i is of the form
	<table style="display:inline-table">
	  <tr><td><pre> x 1 00000</pre></td></tr>
	  <tr><td><pre>     <-k-></pre></td></tr>
	</table>.  Suppose we walk right to position j whose binary
	representation has r trailing 0's, r &lt; k.
      </p>

      <p style="display:inline-block">
	Let j =
	<table style="display:inline-table">
	  <tr><td><pre> y 1 00000</pre></td></tr>
	  <tr><td><pre>     <-r-></pre></td></tr>
	</table>.  
	The leftvalue value stored in BIT[j] stops short of
	the value
	<table style="display:inline-table">
	  <tr><td><pre> y 0 00000</pre></td></tr>
	  <tr><td><pre>     <-r-></pre></td></tr>
	</table>, so this excludes i for sure.
      </p>

      <p style="display:inline-block">
	So, to find the next position j such that BIT[j] includes
	i, we have to find the next position to the right of i
	that has at least k trailing zeros.  This must be i +
	2<sup>k</sup>.  Again, 2<sup>k</sup> is <table style="display:inline-table">
	  <tr><td><pre> 1 00000</pre></td></tr>
	  <tr><td><pre>   <-k-></pre></td></tr>
	</table>, so we add this quantity to i.
      </p>

      <p>
	Call this value Unext(i).  From Unext(i) we go to
	Unext(Unext(i)) etc.  At each step, the number of
	trailing zeros in Unext(j) is one more than in j, so we
	only need to update log N entries.
      </p>

      <p>
	What remains is to compute next(i) and Unext(i)
	efficiently.
      </p>

      <p>
	Since next(i) is i - 2<sup>k</sup> and Unext(i) is i +
	2<sup>i</sup>, this boils down to computing 2<sup>k</sup>
	for a given i, where k is the number of trailing zeros.
      </p>

      <p>
	<table>
	  <tr>
	    <td>
	      We start with i, which is
	    </td>
	    <td>
	      <table style="display:inline-table">
		<tr><td><pre> x  1  00000</pre></td></tr>
		<tr><td><pre>       <-k-></pre></td></tr>
	      </table>
	    </td>
	  </tr>
	  <tr>
	    <td>
	      If we flip all bits, we get
	    </td>
	    <td>
	      <table style="display:inline-table">
		<tr><td><pre> <span style="text-decoration: overline">x</span>  0  11111</pre></td></tr>
		<tr><td><pre>       <-k-></pre></td></tr>
	      </table>
	    </td>
	  </tr>
	  <tr>
	    <td>
	      Now add 1.  We get i', where i' is
	    </td>
	    <td>
	      <table style="display:inline-table">
		<tr><td><pre> <span style="text-decoration: overline">x</span>  1  00000</pre></td></tr>
		<tr><td><pre>       <-k-></pre></td></tr>
	      </table>
	    </td>
	  </tr>
	  <tr>
	    <td>
	      Now, we take a bitwise AND of i and i' and get
	    </td>
	    <td>
	      <table style="display:inline-table">
		<tr><td><pre> 0  1  00000</pre></td></tr>
		<tr><td><pre>       <-k-></pre></td></tr>
	      </table>
	    </td>
	  </tr>
	</table>
      </p>


      <p>
	which is 2<sup>k</sup>.
      </p>

      <p>
	Note that flipping all bits and adding 1 generates the 2's
	complement, which is the way (-i) is represented in all
	computers.  So, we can obtain 2<sup>k</sup> by doing the
	bitwise AND of i and (-i)!
      </p>

      <p>
	How do we build the binary indexed tree to start with?
      </p>

      <p>
	Assume that A consists of all 0's initially, so A[i] =
	BIT[i] = 0 for all i.  Do N updates to insert the initial
	values of A[i], 1 &le; i &le; N, into the tree.  This
	takes N log N time.
      </p>
  
    </div>
  </div> <!-- Right column end -->


    <hr class="noscreen">

  <div class="col-l">
    <div class="col-l-in">
      <h3>Basic topics</h3>
      <ul class="menu">
	<li><a href="introduction.html">Introduction</a></li>
	<li><a href="efficiency.html">Efficiency</a></li>
	<li><a href="binarysearch.html">Searching</a></li>
	<li><a href="sorting.html">Sorting</a></li>
	<li><a href="graphs.html">Basic Graph Algorithms</a></li>
	<li><a href="dp.html">Dynamic Programming</a></li>
	<li><a href="greedy.html">Greedy Algorithms</a></li>
	<li><a href="shortest-paths.html">Computing Shortest Paths</a></li>
	<li><a href="heaps.html">Heaps</a></li>
	<li><a href="permutations.html">Permutations</a></li>
	<li><a href="dags.html">Directed Acyclic Graphs</a></li>
	<li><a href="prefix-sums.html">Computing Prefix Sums</a></li>
	<li><a href="sliding-window.html">Sliding Window Algorithms</a></li>
      </ul>

      <h3>Advanced topics</h3>
      <ul class="menu">
	<li><a href="advanced-graph-algorithms.html">Advanced Graph Algorithms</a></li>
	<li><a href="dp-trees.html">Dynamic Programming on Trees</a></li>
	<li><a href="range-queries.html">Range Queries</a></li>
	<li><a href="network-flows.html">Network Flows</a></li>
	<li><a href="games.html">Games and Strategies</a></li>
	<li><a href="geometry.html">Geometry</a></li>
      </ul>


      <br>

    </div>
  </div> <!-- Left column end -->

  <div class="cleaner">&nbsp;</div>

        </div> <!-- Page end -->

        <div id="footer">
                <ul>
                  <li><a href="..\index-1.html">Home</a>|</li>
                  <li><a href="">Topics</a>|</li>
                  <li><a href="..\problems\index.html">Problems</a>|</li>
                  <li><a href="..\iindex\index.html">Index</a>|</li>
                  <li><a href="..\contact\index.html">Contact</a></li>
                </ul>

        <p><a href="#" onclick="print();" title="Javascript needed for a Print">Print</a> | <a href="#top">Top</a>&uarr;</p>
        </div> <!-- Footer end -->

</div> <!-- Wrapper end -->

<p id="backlinks">&copy;IARCS 2012&ndash;2016</p>
<p id="backlinks"><a href="http://www.pestujemeweb.cz/">Pěstujeme web</a> | visit: <a href="http://www.junglegym.cz/" title="Skluzavky Jungle Gym">Skluzavky</a></p>

</body>
</html>
