<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title></title>

<meta name="Description" content="">
<meta name="author" content="">
<meta name="keywords" content="">

<meta name="robots" content="all,follow">

<!-- CSS --> 
<link rel="stylesheet" href="styles\default.css" type="text/css" media="screen, projection, tv">
<link rel="stylesheet" href="styles\print.css" type="text/css" media="print">

<!-- Favicon -->
<link rel="shortcut icon" href="img\iarcslogo.png" type="image/x-icon">
</head>

<body id="top">
<div id="wrapper">

	<div class="header">
	<h1><span><a href="http://www.iarcs.org.in/inoi"><span id="color">Indian Computing Olympiad</span></a></span></h1>
	<p id="about">Training Material</p>

	<a href="#skip-menu" class="hidden">Skip menu</a> <!-- Skip menu -->
	<div id="menu-box">
	  <ul id="web">
	    <li><a href="..\contact\index.html">Contact</a></li>
	    <li><a href="..\iindex\index.html">Index</a></li>
	    <li><a class="active" id="first" href="index-1.html">Problems</a></li>
	    <li><a href="../topics">Topics</a></li>
	    <li><a href="..\index-1.html">Home</a></li>
	  </ul>
	</div>

	</div> <!-- Header end -->

<hr class="noscreen">

<div id="skip-menu"></div>

<div class="page">
  <div class="col-r">
    <div class="col-r-in">

      <h2>
        <a href="..\topics\heaps.html">Heaps</a>&rarr;Sokoban
      </h2>

      <p>
	Given a square grid with some blocked positions in which
	there is a Sokoban player (S) and a block (B).  The
	player S has to move the block B to a target square T.
	Assume that the grid is at most 20&times;20.
      </p>

      <p>
	Here is an example maze
      </p>

      <pre>
           ###########         S -- You
           #T##......#         B -- Box
           #.#.#..####         # -- Blocked square
           #....B....#         T -- Target
           #.######..#         . -- Empty cell
           #.....S...#
           ###########
      </pre>

      <p>
	The only way to move the block is to push it.  So, there
	are two types of moves for S:
      </p>

      <ul>

	<li>Walk east/west/north/south without pushing :  Represent as e/w/n/s</li>
	<li>Push east/west/north/south:                   Represent as E/W/N/S</li>
      </ul>

      <p>
	To push, S must be oriented correctly with respect to B.
	Thus, to push B west, S must be one square to the east of
	B.  A push moves both S and B one step in the direction
	of the push.
      </p>

      <p>
	Find a way to move B to T that minimizes the number of
	pushes.  If two solutions have the same number of pushes,
	find the one with the minimum number of walks.
      </p>

      <p>
	For example, here is a solution for the grid above:
      </p>

      <pre>
	eennwwWWWWeeeeeesswwwwwwwnnNN
      </pre>

      <div id="solution">
	<h2>Solution</h2>
      </div>

      <p>
	This is clearly a shortest path problem in a graph.  What is the graph?
      </p>

      <ul>

	<li> Vertices are (Sx,Sy,Bx,By)</li>

	<li> For each outgoing vertex, there are four possible
	  outgoing edges of which at most one is a push.  The
	  rest are walks. <br><br>

	  Note that this is a directed graph &mdash; if we go
	  from (Sx,Sy,Bx,By) to (S'x,S'y,B'x,B'y), we may not be
	  able to reverse this move, in particular if the move
	  was a push. <br><br>

	  Note that all our earlier algorithms like BFS, DFS,
	  shortest paths work for directed graphs as well, in
	  essentially the same way as for undirected
	  graphs. </li>

	<li> Target node is any vertex (Sx,Sy,Bx,By) where
	  (Bx,By) = (Tx,Ty).  If we assume that the initial box
	  position is not the target, we have only four
	  possibilities for (Sx,Sy).</li>

	<li> Maintain the cost of a path as a pair (P,W) where P
	  is the number of push move and W is the number walks.
	  So, a push move adds cost (1,1) while a walk move adds
	  (0,1).  Costs are ordered lexicographically:
	  (P,W)&lt;(P',W') if P&lt;P' or P = P' and
	  W&lt;W'. <br><br>

	  We can also map (P,W) to a single integer.  Between
	  each pair of push moves, the Sokoban can make at most
	  N^2 moves. <br><br>

	  So we can map, say, (P,W) to a single integer P*160000
	  + W.  With each push move, we add 160000 and with each
	  walk move we add 1 to the cost.</li>

      </ul>

      <p>
	How do we find the shortest path?
      </p>

      <ol>

	<li>
	  Do BFS, but maintain unexplored configurations with
	  cost in a priority queue (heap), based on cost, rather
	  than in a queue.  At each step, the next configuration
	  to be explored is the minimum cost unexplored
	  configuration in the priority queue.
	</li>

	<li>
	  We can label edges between configurations with the cost
	  added by this edge.  We can then use Dijkstra's
	  algorithm to calculate shortest path in M log M time,
	  where M is the number of edges, using a heap to store
	  burning times of unburnt edges.  Note that the number
	  of edges is small &mdash; each vertex has degree at
	  most 4, so the total number of edges is about 2N.
	  <br><br>

	  Notice that if we use a naive implementation of
	  Dijkstra using an adjacency matrix, we have to store
	  N*N entries which is too large.  However, the edges are
	  defined implicitly so we don't need to construct an
	  explicit representation.
	  <br><br>

	  As a further optimization, we can use an incremental
	  version of Dijkstra's algorithm where we maintain edges
	  in the heap as we visit them.
	</li>
      </ol>

      <hr class="noscreen">
      <br>


    </div>
  </div> <!-- Right column end -->


    <hr class="noscreen">

  <div class="col-l">
    <div class="col-l-in">
      <h3>Problems related to</h3>
      <ul class="menu">
        <li><a href="index-1.html#binarysearch">Searching</a></li>
        <li><a href="index-1.html#sorting">Sorting</a></li>
        <li><a href="index-1.html#graphs">Basic Graph Algorithms</a></li>
        <li><a href="index-1.html#dp">Dynamic Programming</a></li>
        <li><a href="index-1.html#greedy">Greedy Algorithms</a></li>
        <li><a href="">Computing Shortest Paths</a></li>
        <li><a href="index-1.html#heaps">Heaps</a></li>
        <li><a href="index-1.html#permutations">Permutations</a></li>
        <li><a href="index-1.html#dags">Directed Acyclic Graphs</a></li>
        <li><a href="index-1.html#prefix-sums">Computing Prefix Sums</a></li>
        <li><a href="index-1.html#sliding-window">Sliding Window Algorithms</a></li>
        <li><a href="index-1.html#advanced-graph-algorithms">Advanced Graph Algorithms</a></li>
        <li><a href="index-1.html#dp-trees">Dynamic Programming on Trees</a></li>
        <li><a href="index-1.html#range-queries">Range Queries</a></li>
        <li><a href="index-1.html#network-flows">Network Flows</a></li>
        <li><a href="index-1.html">Games and Strategies</a></li>
        <li><a href="index-1.html#geometry">Geometry</a></li>
      </ul>


      <br>

    </div>
  </div> <!-- Left column end -->

  <div class="cleaner">&nbsp;</div>

        </div> <!-- Page end -->

        <div id="footer">
                <ul>
                  <li><a href="..\index-1.html">Home</a>|</li>
                  <li><a href="../topics">Topics</a>|</li>
                  <li><a href="">Problems</a>|</li>
                  <li><a href="..\iindex\index.html">Index</a>|</li>
                  <li><a href="..\contact\index.html">Contact</a></li>
                </ul>

        <p><a href="#" onclick="print();" title="Javascript needed for a Print">Print</a> | <a href="#top">Top</a>&uarr;</p>
        </div> <!-- Footer end -->

</div> <!-- Wrapper end -->

<p id="backlinks">&copy;IARCS 2012&ndash;2016</p>
<p id="backlinks"><a href="http://www.pestujemeweb.cz/">Pěstujeme web</a> | visit: <a href="http://www.junglegym.cz/" title="Skluzavky Jungle Gym">Skluzavky</a></p>

</body>
</html>
