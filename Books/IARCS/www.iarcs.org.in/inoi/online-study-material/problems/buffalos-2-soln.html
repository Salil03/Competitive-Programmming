<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title></title>

<meta name="Description" content="">
<meta name="author" content="">
<meta name="keywords" content="">

<meta name="robots" content="all,follow">

<!-- CSS --> 
<link rel="stylesheet" href="styles\default.css" type="text/css" media="screen, projection, tv">
<link rel="stylesheet" href="styles\print.css" type="text/css" media="print">

<!-- Favicon -->
<link rel="shortcut icon" href="img\iarcslogo.png" type="image/x-icon">
</head>

<body id="top">
<div id="wrapper">

	<div class="header">
	<h1><span><a href="http://www.iarcs.org.in/inoi"><span id="color">Indian Computing Olympiad</span></a></span></h1>
	<p id="about">Training Material</p>

	<a href="#skip-menu" class="hidden">Skip menu</a> <!-- Skip menu -->
	<div id="menu-box">
	  <ul id="web">
	    <li><a href="..\contact\index.html">Contact</a></li>
	    <li><a href="..\iindex\index.html">Index</a></li>
	    <li><a class="active" id="first" href="index-1.html">Problems</a></li>
	    <li><a href="../topics">Topics</a></li>
	    <li><a href="..\index-1.html">Home</a></li>
	  </ul>
	</div>

	</div> <!-- Header end -->

<hr class="noscreen">

<div id="skip-menu"></div>

<div class="page">
  <div class="col-r">
    <div class="col-r-in">

      <h2>
        <a href="..\topics\dp.html">Dynamic Programming</a>&rarr;Speculating on buffalos, Version 2
      </h2>

      <p>
	Ramu was a lazy farmer. He had inherited a fairly large
	farm and a nice house from his father. Ramu leased out
	the farm land to others and earned a rather handsome
	income. His father used to keep a buffalo at home and
	sell its milk but the buffalo died a few days after his
	father did.
      </p>

      <p>
	Ramu too wanted to make some money from buffalos, but in a quite a
	different way. He decided that his future lay in speculating on
	buffalos. In the market in his village, buffalos were bought and sold
	everyday. The price fluctuated over the year, but on any single day the
	price was always the same.
      </p>

      <p>
	He decided that he would buy buffalos when the price was low and sell them
	when the price was high and, in the process, accummulate great
	wealth. Unfortunately his house had space for just one buffalo and so he
	could own at most one buffalo at any time.
      </p>

      <p>
	Before he entered the buffalo market, he decided to examine to examine the
	variation in the price of buffalos over the last few days and determine
	the maximum profit he could have made.
      </p>

      <p>
	Suppose the price of a buffalo over a period of 10 days varied as
      </p>

      <pre>
	-------------------------------------------------
	Day   :  1   2   3   4   5   6   7   8   9  10
	-------------------------------------------------
	Price : 11   7  10   9  13  14  10  15  12  10
	-------------------------------------------------
      </pre>

      <p>
	The maximum money he can make in this case is 13 ---
      </p>

      <ul>
	<li>buy on day 2, sell on day 3 (+3)</li>
	<li>buy on day 4, sell on day 6 (+5)</li>
	<li>buy on day 7, sell on day 8 (+5)</li>
      </ul>

      <p>
	To discourage speculation, the panchayat has decided to
	charge a transaction fee.  Each time a buffalo is bought
	or sold, Rs 2 has to be paid to the panchayat.  What
	should Ramu's strategy be now?
      </p>

      <pre>
	-------------------------------------------------
	Day   :  1   2   3   4   5   6   7   8   9  10
	-------------------------------------------------
	Price : 11   7  10   9  13  14  10  15  12  10
	-------------------------------------------------
      </pre>

      <p>
	Example:
      </p>

      <ul>
	<li> buy on day 2, sell on day 6 --- profit is (14-7) - 4 = 3</li>
	<li> buy on day 7, sell on day 8 --- profit is (15-10) - 4 = 1</li>
      </ul>

      <div id="solution">
	<h2>Solution</h2>
      </div>

      <p>
	Let Profit[i..N] be the money Ramu can make on days i..N, assuming he has
	no buffalos at the start of day i.
      </p>

      <p>
	On day i, Ramu can either buy or not buy a buffalo.
      </p>

      <p>
	If Ramu does not buy on day i, it is as though Ramu started his
	transactions directly on day i+1.  So,
      </p>

      <ul>
	<li>Profit[i..N] = Profit[i+1..N]</li>
      </ul>

      <p>
	If Ramu does buy on day i, the money he makes depends on when he sells the
	buffalo:
      </p>

      <ul>

	<li>
	  If he sells on day i+1, the money he makes is
	  Price(day i+1) - Price(day i) - 4 + Profit[i+2..N]
	</li>

	<li>
	  If he sells on day i+2, the money he makes is
	  Price(day i+2) - Price(day i) - 4 + Profit[i+3..N]<br>

	  &hellip;
	</li>

	<li>
	  If he sells on day N-2, the money he makes is
	  Price(day N-2) - Price(day i) - 4 + Profit[N-1..N]
	</li>

	<li>
	  If he sells on day N-1, the money he makes is
	  Price(day N-1) - Price(day i) - 4 + Profit[N]
	</li>

	<li>
	  Notice that Profit[N] is zero since he cannot buy and sell a buffalo in
	  one day. If he sells on day N, the money he makes is.
	  Price(day N) - Price(day i) - 4
	</li>

      </ul>

      <p>
	Ramu's best strategy is to calculate the maximum of all these quantities.
      </p>


      <ul>
	<li>
	  Profit[i..N] =<br>
	    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;max (<br>
	  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Profit[i+1..N],<br>
	  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Price(i+1) - Price(i) - 4 + Profit[i+2..N],<br>
	  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Price(i+2) - Price(i) - 4 + Profit[i+3..N],<br>
	  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&hellip;<br>
	  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Price(N-2) - Price(i) - 4 + Profit[N-1..N],<br>
	  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Price(N-1) - Price(i) - 4 + Profit[N],<br>
	  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Price(N) - Price(i) - 4<br>
	    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            )</li>
      </ul>

      <p>
	Using this we can compute explicitly
      </p>

      <ul>
	<li>
	  Profit[N-1] = max (Profit[N],
          Price(N) - Price(N-1) - 4)
	</li>
      </ul>

      <p>
	Once we know Profit[N] and Profit[N-1], we can compute Profit[N-2]
	explicitly
      </p>

      <ul>
	<li>
	  Profit[N-2] = max (Profit[N-1],
          Price(N-1) - Price(N-2) - 4 + Profit[N],
          Price(N) - Price(N-2) - 4)
	</li>
      </ul>

      <p>
	Continuing in this vein, we can compute Profit[N-3], Profit[N-4], ...,
	Profit[i].  In general, the final answer that we want is Profit[1].
      </p>


      <p>
	A linear time algorithm:
      </p>

      <ul>
	<li>
	  With[i]    &mdash; max profit starting i, if Ramu already has a buffalo
	</li>
	<li>
	  Without[i] &mdash; max profit starting i, if Ramu does not have a buffalo
	</li>

	<li>
	  With[i]     = max { With[i-1], Without[i-1] - Price(i) - 2 }<br><br>
	  
	  If Ramu has a buffalo at i, either he already had it at
	  i-1 (With[i-1]), or he did not have it at i-1 and
	  bought it at i (Without[i-1] - Price(i) - 2)
	</li>

	<li>
	  Without[i]  = max { Without[i-1], With[i-1] + Price(i) - 2 }
	</li>

      </ul>

      <hr class="noscreen">
      <br>


    </div>
  </div> <!-- Right column end -->


    <hr class="noscreen">

  <div class="col-l">
    <div class="col-l-in">
      <h3>Problems related to</h3>
      <ul class="menu">
        <li><a href="index-1.html#binarysearch">Searching</a></li>
        <li><a href="index-1.html#sorting">Sorting</a></li>
        <li><a href="index-1.html#graphs">Basic Graph Algorithms</a></li>
        <li><a href="index-1.html#dp">Dynamic Programming</a></li>
        <li><a href="index-1.html#greedy">Greedy Algorithms</a></li>
        <li><a href="">Computing Shortest Paths</a></li>
        <li><a href="index-1.html#heaps">Heaps</a></li>
        <li><a href="index-1.html#permutations">Permutations</a></li>
        <li><a href="index-1.html#dags">Directed Acyclic Graphs</a></li>
        <li><a href="index-1.html#prefix-sums">Computing Prefix Sums</a></li>
        <li><a href="index-1.html#sliding-window">Sliding Window Algorithms</a></li>
        <li><a href="index-1.html#advanced-graph-algorithms">Advanced Graph Algorithms</a></li>
        <li><a href="index-1.html#dp-trees">Dynamic Programming on Trees</a></li>
        <li><a href="index-1.html#range-queries">Range Queries</a></li>
        <li><a href="index-1.html#network-flows">Network Flows</a></li>
        <li><a href="index-1.html">Games and Strategies</a></li>
        <li><a href="index-1.html#geometry">Geometry</a></li>
      </ul>


      <br>

    </div>
  </div> <!-- Left column end -->

  <div class="cleaner">&nbsp;</div>

        </div> <!-- Page end -->

        <div id="footer">
                <ul>
                  <li><a href="..\index-1.html">Home</a>|</li>
                  <li><a href="../topics">Topics</a>|</li>
                  <li><a href="">Problems</a>|</li>
                  <li><a href="..\iindex\index.html">Index</a>|</li>
                  <li><a href="..\contact\index.html">Contact</a></li>
                </ul>

        <p><a href="#" onclick="print();" title="Javascript needed for a Print">Print</a> | <a href="#top">Top</a>&uarr;</p>
        </div> <!-- Footer end -->

</div> <!-- Wrapper end -->

<p id="backlinks">&copy;IARCS 2012&ndash;2016</p>
<p id="backlinks"><a href="http://www.pestujemeweb.cz/">Pěstujeme web</a> | visit: <a href="http://www.junglegym.cz/" title="Skluzavky Jungle Gym">Skluzavky</a></p>

</body>
</html>
